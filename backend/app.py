from flask import Flask, jsonify
from elasticsearch import Elasticsearch
import os
from dotenv import load_dotenv
load_dotenv()

app = Flask(__name__)

input_vector = [-0.7358680367469788, -0.45447126030921936, -0.9688554406166077, 0.7444916367530823, 0.8471623659133911, -0.1766035109758377, 0.6313608884811401, -0.028649866580963135, -0.8375827670097351, -0.9996403455734253, -0.3959497809410095, 0.9846460819244385, 0.9509798884391785, 0.6785813570022583, 0.7934638857841492, -0.633606493473053, -0.28738242387771606, -0.531176745891571, 0.1962035447359085, 0.4554605484008789, 0.6784108281135559, 0.9999977946281433, -0.36282065510749817, 0.33143794536590576, 0.15154381096363068, 0.9913908839225769, -0.6596270799636841, 0.8843887448310852, 0.859843909740448, 0.766048014163971, -0.4206483066082001, 0.02216445654630661, -0.9904911518096924, 0.10250675678253174, -0.9728322625160217, -0.9763758778572083, 0.4214133322238922, -0.24649368226528168, 0.31064823269844055, 0.31143972277641296, -0.8680213093757629, 0.05471844598650932, 0.9999071955680847, -0.725890576839447, 0.6743918657302856, 0.04208308830857277, -0.9999991655349731, 0.12444832921028137, -0.8189613819122314, 0.9200698137283325, 0.9042890667915344, 0.9536455273628235, 0.023981932550668716, 0.3978857696056366, 0.48818206787109375, -0.617980420589447, -0.18628256022930145, 0.029338223859667778, -0.17794378101825714, -0.41021469235420227, -0.5249817371368408, 0.22976213693618774, -0.9239519238471985, -0.6353766322135925, 0.9180607795715332, 0.8961187601089478, -0.0377231240272522, -0.20088493824005127, -0.09381238371133804, -0.26210254430770874, 0.8031521439552307, -0.11885637789964676, -0.40063947439193726, -0.8416139483451843, 0.6733534336090088, 0.07669951021671295, -0.5624445676803589, 0.9999997615814209, -0.3806712031364441, -0.9660180807113647, 0.9770966172218323, 0.8549252152442932, 0.4483110308647156, -0.4419482946395874, 0.43541911244392395, -0.9999997615814209, 0.5554091930389404, 0.0312788300216198, -0.9816823601722717, 0.02651107683777809, 0.6184771656990051, -0.22429534792900085, 0.961870014667511, 0.4565434753894806, -0.4229620099067688, -0.4475841522216797, -0.12101973593235016, -0.9406288266181946, -0.07328833639621735, -0.5683591961860657, 0.03517018258571625, 0.09856471419334412, -0.14901451766490936, -0.2623508870601654, 0.32157841324806213, -0.4179961383342743, -0.4909726083278656, 0.763843834400177, 0.5815116763114929, 0.5888947248458862, 0.4531538188457489, -0.2179410606622696, 0.19514527916908264, -0.8654098510742188, 0.39118120074272156, -0.3659785985946655, -0.9728720188140869, -0.5200578570365906, -0.9847739934921265, 0.6004510521888733, -0.43123704195022583, -0.09353730827569962, 0.8334100842475891, -0.651788592338562, 0.3800506889820099, 2.385210245847702e-05, -0.9642305970191956, -0.9999997615814209, -0.638522744178772, -0.7452574968338013, -0.18412794172763824, -0.24371029436588287, -0.9611303210258484, -0.9621111154556274, 0.45864516496658325, 0.889014720916748, 0.15048760175704956, 0.9996230006217957, -0.006148811429738998, 0.8682964444160461, -0.30336955189704895, -0.7184194922447205, 0.7513405084609985, -0.232028067111969, 0.7986030578613281, -0.3151804506778717, -0.1619841605424881, -0.05166131630539894, -0.6673055291175842, 0.1981056034564972, -0.868016242980957, 0.08138631284236908, -0.8913547396659851, -0.854559063911438, -0.1436704397201538, 0.8877879977226257, -0.8146001696586609, -0.9476230144500732, -0.2738911509513855, 0.07507440447807312, -0.3053874373435974, 0.6251372694969177, 0.8635555505752563, 0.24208347499370575, -0.5327948927879333, 0.3145029842853546, -0.16124707460403442, 0.3182491958141327, -0.6706386804580688, 0.03276411443948746, 0.1793794184923172, -0.3151363432407379, -0.9513399600982666, -0.9740002155303955, -0.153995081782341, 0.13761752843856812, 0.9801952838897705, 0.48063215613365173, 0.21475113928318024, 0.8015535473823547, -0.2814626395702362, 0.6035689115524292, -0.9241257309913635, 0.9724192023277283, 0.02197353169322014, 0.2072649449110031, -0.8512319326400757, 0.565885603427887, -0.6713100075721741, 0.2406785637140274, 0.5662625432014465, -0.8302207589149475, -0.6061179041862488, 0.048683229833841324, -0.41228196024894714, -0.22073663771152496, -0.9416679739952087, 0.1712813526391983, -0.23228175938129425, -0.2464042454957962, -0.029407652094960213, 0.9113662242889404, 0.7819090485572815, 0.6058192253112793, 0.45164310932159424, 0.5570957064628601, -0.6921620965003967, -0.49300238490104675, -0.015270646661520004, -0.12114100158214569, -0.04289781302213669, 0.9823145866394043, -0.8800199031829834, 0.06910949945449829, -0.8298042416572571, -0.9666137099266052, -0.2943638563156128, -0.8355180025100708, -0.21531546115875244, -0.5618042349815369, 0.5889350175857544, -0.7819815278053284, 0.3613142669200897, 0.27695396542549133, -0.6409839987754822, -0.6828345656394958, 0.4106118977069855, -0.19885696470737457, 0.3227670192718506, -0.22131027281284332, 0.9961925148963928, 0.9707396626472473, -0.6494888067245483, 0.12050366401672363, 0.9612036943435669, -0.9910875558853149, -0.7294648885726929, 0.30615267157554626, -0.18687094748020172, 0.7519424557685852, -0.42317038774490356, 0.9323058724403381, 0.9281507730484009, 0.7401959896087646, -0.7851206064224243, -0.8840336203575134, -0.5887128710746765, -0.657591700553894, 0.03653087094426155, -0.01753191463649273, 0.9027326107025146, 0.6068513989448547, 0.34052351117134094, 0.4362959563732147, -0.19691649079322815, 0.9360218048095703, -0.9988294839859009, -0.9320386648178101, -0.8930751085281372, -0.07544112950563431, -0.9850224852561951, 0.9399049282073975, 0.1025332435965538, 0.9155068397521973, -0.36845481395721436, -0.5600863099098206, -0.9478926658630371, 0.4420831799507141, 0.029002321884036064, 0.8696362376213074, -0.7931849360466003, -0.6323574781417847, -0.6369525194168091, -0.8993290066719055, -0.3008576035499573, -0.2764866054058075, -0.6406921148300171, -0.1090579628944397, -0.8922003507614136, 0.5148922801017761, 0.5612186789512634, 0.4219818115234375, -0.9311991930007935, 0.9900863170623779, 0.9999997615814209, 0.953094482421875, 0.6823650002479553, 0.18878670036792755, -0.9999701976776123, -0.9238662719726562, 0.9998599886894226, -0.9972178339958191, -0.9999997615814209, -0.8347979187965393, -0.5998673439025879, 0.29106780886650085, -0.9999997615814209, -0.12551070749759674, 0.23119008541107178, -0.7862606644630432, 0.6831481456756592, 0.9321134090423584, 0.9160449504852295, -0.9999997615814209, 0.5333160758018494, 0.8592155575752258, -0.49315762519836426, 0.9766131043434143, -0.4633600413799286, 0.9253034591674805, 0.7645263671875, 0.6622545123100281, 0.060227926820516586, 0.1922461986541748, -0.9799824357032776, -0.5518417358398438, -0.76939457654953, -0.9228783249855042, 0.9997782111167908, -0.005307587794959545, -0.7269786596298218, -0.634291410446167, 0.7849450707435608, -0.0042192768305540085, -0.11102288216352463, -0.9458898305892944, -0.17646494507789612, 0.4160977900028229, 0.6795561909675598, 0.230198934674263, 0.2111906111240387, -0.3377447724342346, 0.03222346305847168, 0.4644199013710022, -0.3560418486595154, 0.4992605745792389, -0.7775383591651917, -0.10029766708612442, 0.476281076669693, -0.14207039773464203, -0.6961925625801086, -0.9648789763450623, 0.897783637046814, -0.008671603165566921, 0.8125092387199402, 0.9999997615814209, 0.6673985123634338, -0.6461097002029419, 0.7003422975540161, 0.17057354748249054, -0.8523382544517517, 0.9999997615814209, 0.900351881980896, -0.9595297574996948, -0.503909170627594, 0.7983061075210571, -0.48547646403312683, -0.5487204194068909, 0.9937490224838257, -0.06786558777093887, -0.8118314146995544, -0.6160064339637756, 0.9816495180130005, -0.9840233325958252, 0.9991676211357117, -0.7519358396530151, -0.9601650834083557, 0.9361889958381653, 0.928149938583374, -0.7313814759254456, -0.3524191379547119, -0.012955494225025177, -0.5670628547668457, 0.3718203008174896, -0.7477048635482788, 0.6023840308189392, 0.3763658404350281, 0.16278663277626038, 0.8787082433700562, 0.1789446920156479, -0.5398688316345215, 0.11673635989427567, -0.7108330726623535, -0.002674632705748081, 0.9757909774780273, 0.31549593806266785, -0.027635272592306137, -0.10336249321699142, 0.027266960591077805, -0.9580137133598328, -0.9349871277809143, 0.7469790577888489, 0.9999997615814209, -0.3423943817615509, 0.9545236229896545, -0.4611250162124634, 0.12596829235553741, -0.011144778691232204, 0.5120065212249756, 0.4706178903579712, -0.0938403457403183, -0.5860456228256226, 0.8489634394645691, -0.8213604688644409, -0.9848739504814148, 0.2232484072446823, 0.06417728215456009, -0.040077801793813705, 0.9999569654464722, 0.36843636631965637, 0.13682347536087036, 0.310357004404068, 0.9854873418807983, -0.21422718465328217, -0.11348825693130493, 0.9135990738868713, 0.9762166738510132, -0.09121482074260712, 0.528376042842865, 0.594916045665741, -0.9075872302055359, -0.1267629861831665, -0.5511218309402466, -0.11874238401651382, -0.9564953446388245, 0.2501724064350128, -0.9357770681381226, 0.9538828730583191, 0.9233055710792542, 0.1604805886745453, 0.1316264271736145, 0.9025587439537048, 0.9999997615814209, -0.976807713508606, 0.2686236500740051, 0.7746947407722473, 0.037195269018411636, -0.9999845623970032, -0.4778793454170227, -0.29270458221435547, -0.005756387021392584, -0.9125199913978577, -0.28399741649627686, 0.15732644498348236, -0.927769124507904, 0.8449029922485352, 0.7410609722137451, -0.9081434011459351, -0.9620322585105896, -0.5082978010177612, 0.4449925720691681, -0.03931022807955742, -0.997271716594696, -0.5657857060432434, -0.32449451088905334, 0.7177864909172058, -0.17493630945682526, -0.8826954364776611, -0.23087601363658905, -0.22475789487361908, 0.26537641882896423, -0.05859079211950302, 0.5671374797821045, 0.8838717937469482, 0.8866523504257202, -0.9422494769096375, -0.6271736025810242, -0.0860094279050827, -0.61492520570755, 0.7483412027359009, -0.6225245594978333, -0.9668503403663635, 0.007984360679984093, 0.9999997615814209, -0.5332829356193542, 0.9688087105751038, 0.5145954489707947, 0.5287389159202576, -0.04419282451272011, 0.04671202227473259, 0.9737620949745178, 0.2875516712665558, -0.6720291376113892, -0.8998146653175354, 0.8426762223243713, -0.27754509449005127, 0.678579568862915, 0.9551467299461365, 0.7505082488059998, 0.7037966251373291, 0.9200677275657654, 0.09022301435470581, 0.049176402390003204, -0.1307132989168167, 0.9789564609527588, 0.0013034509029239416, -0.21750277280807495, -0.26171836256980896, -0.15486659109592438, -0.3119298815727234, 0.583299994468689, 0.9999997615814209, 0.05278543010354042, 0.6650111675262451, -0.9730379581451416, -0.9096094965934753, -0.48638853430747986, 0.9999997615814209, 0.8302228450775146, -0.16697824001312256, 0.7217936515808105, 0.4739038646221161, 0.04717737063765526, 0.3996000289916992, -0.015229959972202778, -0.09489670395851135, 0.0341963954269886, -0.093573659658432, 0.9050421118736267, -0.49878907203674316, -0.962903618812561, -0.3784548044204712, 0.2660958170890808, -0.9474878311157227, 0.9999913573265076, -0.4995060861110687, -0.19639189541339874, -0.27155524492263794, -0.5761191844940186, -0.903465747833252, -0.22528815269470215, -0.9700802564620972, -0.010601785033941269, 0.20378378033638, 0.9095556139945984, -0.012377806939184666, -0.5235355496406555, -0.7792604565620422, 0.830038845539093, 0.7949883341789246, -0.9470437169075012, -0.8546631932258606, 0.9193629026412964, -0.9184170365333557, 0.7126686573028564, 0.9999997615814209, 0.2664121091365814, 0.23981931805610657, 0.18400467932224274, -0.39915257692337036, 0.3556470572948456, -0.6867703199386597, 0.5111660361289978, -0.9090251922607422, -0.35939809679985046, -0.08477351069450378, 0.039118796586990356, -0.03331172093749046, -0.8371536135673523, 0.14064261317253113, -0.047373466193675995, -0.39547187089920044, -0.529270350933075, -0.022631395608186722, 0.40030908584594727, 0.6789058446884155, -0.021560439839959145, 0.05073932558298111, 0.1495620757341385, 0.036271341145038605, -0.7166216373443604, -0.4043417274951935, -0.31449493765830994, -0.999998927116394, 0.5007203221321106, -0.9999997615814209, 0.7021644711494446, 0.11302422732114792, -0.09261666238307953, 0.7213480472564697, 0.9078317880630493, 0.8528527617454529, -0.5535339117050171, -0.9285547137260437, 0.3038865029811859, 0.5729365348815918, -0.24430716037750244, -0.16065193712711334, -0.45918339490890503, 0.24061018228530884, 0.09746192395687103, 0.2477550357580185, -0.7164264917373657, 0.7002434730529785, -0.2007034718990326, 0.9999997615814209, 0.13401494920253754, -0.6598137617111206, -0.8084880709648132, 0.09017597138881683, -0.1515571027994156, 0.9999997615814209, -0.6618458032608032, -0.9220499396324158, 0.18913671374320984, -0.706669270992279, -0.6864092350006104, 0.33560630679130554, -0.07783781737089157, -0.7352089881896973, -0.9657846689224243, 0.7331151962280273, 0.34764036536216736, -0.6199634671211243, 0.6279723048210144, -0.003523467108607292, -0.4943731725215912, -0.22697396576404572, 0.9375004172325134, 0.9821715950965881, 0.6698254942893982, 0.8200245499610901, -0.7261235117912292, -0.6834221482276917, 0.9536343216896057, 0.2463231086730957, -0.3810095489025116, -0.17267878353595734, 0.9999997615814209, 0.2262914925813675, -0.8907113075256348, -0.18691906332969666, -0.9516856074333191, 0.06152069568634033, -0.8978251218795776, 0.16399195790290833, 0.06933961063623428, 0.9002901911735535, -0.1343020647764206, 0.8516951203346252, -0.8707836270332336, -0.2449166476726532, -0.5303633213043213, -0.6824079155921936, 0.3714725971221924, -0.9052827954292297, -0.9688737988471985, -0.9701076149940491, 0.6807888150215149, -0.14965149760246277, 0.17991816997528076, 0.3455587327480316, -0.28905749320983887, 0.43714639544487, 0.1918325275182724, -0.9999997615814209, 0.9086277484893799, 0.2736116349697113, 0.8931170701980591, 0.929804801940918, 0.8082216382026672, 0.6671477556228638, 0.16422025859355927, -0.958961009979248, -0.8678579926490784, -0.2894667983055115, -0.1151980310678482, 0.5199649333953857, 0.6346626877784729, 0.8173889517784119, 0.23684453964233398, -0.2685853838920593, -0.8317860960960388, -0.8677799105644226, -0.9906261563301086, -0.9880844354629517, 0.13029761612415314, -0.6114012598991394, -0.6425327658653259, 0.9453092813491821, -0.1277984231710434, -0.04385674372315407, -0.48179003596305847, -0.9157017469406128, 0.12354835867881775, 0.2571287155151367, 0.03887972608208656, -0.10081411898136139, 0.4085318446159363, 0.7124601006507874, 0.660958468914032, 0.9336795806884766, -0.9371179342269897, 0.21690940856933594, -0.8752480149269104, 0.3633297085762024, 0.9657896161079407, -0.9208257794380188, 0.12613406777381897, 0.6795817613601685, -0.07778335362672806, 0.1474938839673996, -0.1171221062541008, -0.74751877784729, 0.43615227937698364, -0.26913952827453613, 0.6519928574562073, -0.23249506950378418, 0.21386496722698212, -0.2801642119884491, 0.0006449733627960086, -0.5019166469573975, -0.623616099357605, 0.587421178817749, 0.16781803965568542, 0.8222221732139587, 0.9508808255195618, 0.1554931253194809, -0.40417665243148804, -0.052066780626773834, -0.7988458275794983, -0.8473162055015564, 0.6160865426063538, 0.058406952768564224, -0.0942978709936142, 0.9152547717094421, -0.06303485482931137, 0.9591063261032104, 0.5116885304450989, -0.34510326385498047, -0.2290789783000946, -0.6728384494781494, 0.6076443791389465, -0.8877182006835938, -0.43535783886909485, -0.576185941696167, 0.46895521879196167, 0.13843899965286255, 0.9999984502792358, -0.8796179890632629, -0.9263647794723511, -0.7692124247550964, -0.3383776545524597, 0.42368239164352417, -0.4268094301223755, -0.9999997615814209, 0.19393347203731537, -0.7769812345504761, 0.7961556911468506, -0.8246474862098694, 0.9585972428321838, -0.6403067111968994, -0.8574082851409912, -0.14047326147556305, 0.8377137780189514, 0.9013277888298035, -0.3312772810459137, -0.3246314823627472, 0.5084674954414368, -0.04310586303472519, 0.9879886507987976, 0.6810082197189331, 0.055754855275154114, 0.09171856194734573, 0.595975399017334, -0.9501870274543762, -0.5356242656707764, 0.8986373543739319]

input_vector = [float(x) for x in input_vector]

index_name = "search-business-data"

user = 'elastic'
password = os.environ.get('ELASTIC_PASSWORD')

# Configure Elasticsearch
es = Elasticsearch(
  "https://localhost:9200",
  basic_auth=(user, password),
  verify_certs=False
)

@app.route('/search', methods=['POST'])
def search():
    query = {
        "query": {
            "script_score": {
                "query": {"match_all": {}},
                "script": {
                    "source": "cosineSimilarity(params.query_vector, 'encoding') + 1.0",
                    "params": {"query_vector": input_vector}
                },
            }
        }
    }
    try:
        response = es.search(index=index_name, body=query)
        response_data = [hit['_source'] for hit in response['hits']['hits']]

        return jsonify({'response': response_data}), 200

    except Exception as e:
        return jsonify({'error': str(e)})

if __name__ == '__main__':
    app.run(debug=True)